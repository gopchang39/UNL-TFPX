<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Checklist Manager</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --light: #ecf0f1;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; background: #f4f7f6; }
        h2 { color: var(--primary); }
        
        .controls { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
        
        table { border-collapse: collapse; width: 100%; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 0.85rem; }
        th { background-color: var(--primary); color: white; position: sticky; top: 0; }
        
        .cell-container { display: flex; flex-direction: column; gap: 4px; min-width: 140px; position: relative; }
        select, input[type="datetime-local"] { width: 100%; font-size: 0.75rem; border: 1px solid #ccc; border-radius: 3px; }
        
        .note-area { width: 100%; height: 40px; font-size: 0.7rem; resize: none; margin-top: 4px; }
        .copy-btn { 
            position: absolute; bottom: 5px; right: 5px; 
            font-size: 0.6rem; padding: 1px 3px; cursor: pointer;
            background: var(--light); border: 1px solid #ccc; border-radius: 2px;
        }
        .copy-btn:hover { background: #ddd; }

        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; }
        .btn-add { background: #27ae60; }
        .btn-export { background: #f39c12; }
        .btn-remove { background: #e74c3c; padding: 4px 8px; font-size: 0.7rem; }
        
        .global-note { margin-top: 20px; width: 100%; height: 60px; }
    </style>
</head>
<body>

    <h2>Module Assembly Checklist</h2>

    <div class="controls">
        <input type="text" id="newTaskId" placeholder="Enter New Task ID (e.g. SH005)">
        <button class="btn btn-add" onclick="addRow()">Add Row to Top</button>
        <button class="btn btn-export" onclick="exportToCSV()">Export to CSV</button>
    </div>

    <table id="checkListTable">
        <thead>
            <tr id="headerRow">
                <th>Task ID</th>
                <th>HDI check</th>
                <th>Sensor-ROC check</th>
                <th>Module gluing</th>
                <th>Spacer gluing</th>
                <th>Wire bonding</th>
                <th>Pull test</th>
                <th>Carrier assembly</th>
                <th>Electrical test</th>
                <th>Shipped</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>

    <h3>General Checklist Notes</h3>
    <textarea id="globalNotes" class="global-note" placeholder="Add general notes for the entire checklist here..." oninput="saveData()"></textarea>

    <script>
        const names = ["IK", "CJ", "AR", "JM", "JB"];
        const columns = ["HDI check", "Sensor-ROC", "Module glue", "Spacer glue", "Wire bond", "Pull test", "Carrier", "Electrical", "Shipped"];
        let data = JSON.parse(localStorage.getItem('productionData')) || [
            { id: "SH004", cells: {} },
            { id: "SH003", cells: {} },
            { id: "SH002", cells: {} },
            { id: "SH001", cells: {} }
        ];

        function init() {
            renderTable();
            document.getElementById('globalNotes').value = localStorage.getItem('globalNotes') || "";
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            data.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                
                // Task ID Column
                tr.innerHTML += `<td><strong>${row.id}</strong></td>`;

                // Data Columns
                for(let i = 0; i < 9; i++) {
                    const cellData = row.cells[i] || { time: "", name: "", note: "" };
                    tr.appendChild(createCell(rowIndex, i, cellData));
                }

                // Remove Action Column (Far Right)
                tr.innerHTML += `<td><button class="btn btn-remove" onclick="removeRow(${rowIndex})">Remove</button></td>`;
                tbody.appendChild(tr);
            });
        }

        function createCell(rowIndex, colIndex, cellData) {
            const td = document.createElement('td');
            let options = names.map(n => `<option value="${n}" ${cellData.name === n ? 'selected' : ''}>${n}</option>`).join('');
            
            td.innerHTML = `
                <div class="cell-container">
                    <input type="datetime-local" value="${cellData.time}" onchange="updateCell(${rowIndex}, ${colIndex}, 'time', this.value)">
                    <select onchange="updateCell(${rowIndex}, ${colIndex}, 'name', this.value)">
                        <option value="">--Name--</option>
                        ${options}
                    </select>
                    <textarea class="note-area" placeholder="Note..." oninput="updateCell(${rowIndex}, ${colIndex}, 'note', this.value)">${cellData.note}</textarea>
                    <button class="copy-btn" onclick="copyNote(this)">copy</button>
                </div>
            `;
            return td;
        }

        function updateCell(rowIndex, colIndex, field, value) {
            if (!data[rowIndex].cells[colIndex]) data[rowIndex].cells[colIndex] = {};
            data[rowIndex].cells[colIndex][field] = value;
            saveData();
        }

        function addRow() {
            const idInput = document.getElementById('newTaskId');
            if (!idInput.value) return alert("Enter Task ID");
            
            // Unshift adds to the top (newest first)
            data.unshift({ id: idInput.value, cells: {} });
            idInput.value = '';
            saveData();
            renderTable();
        }

        function removeRow(index) {
            if(confirm("Delete this row?")) {
                data.splice(index, 1);
                saveData();
                renderTable();
            }
        }

        function saveData() {
            localStorage.setItem('productionData', JSON.stringify(data));
            localStorage.setItem('globalNotes', document.getElementById('globalNotes').value);
        }

        function copyNote(btn) {
            const text = btn.previousElementSibling.value;
            navigator.clipboard.writeText(text);
            const original = btn.innerText;
            btn.innerText = "âœ“";
            setTimeout(() => btn.innerText = original, 1000);
        }

        function exportToCSV() {
            let csv = "Task ID,HDI check Time,Name,Notes,Sensor-ROC Time,Name,Notes,Module Glue Time,Name,Notes...\n";
            data.forEach(row => {
                let line = `"${row.id}"`;
                for(let i=0; i<9; i++) {
                    const c = row.cells[i] || {time:'', name:'', note:''};
                    line += `,"${c.time}","${c.name}","${c.note.replace(/"/g, '""')}"`;
                }
                csv += line + "\n";
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', `checklist_export_${new Date().toLocaleDateString()}.csv`);
            a.click();
        }

        init();
    </script>
</body>
</html>